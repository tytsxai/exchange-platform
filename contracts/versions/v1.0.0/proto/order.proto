syntax = "proto3";

package exchange.order.v1;

option go_package = "github.com/exchange/common/gen/order/v1;orderv1";

import "google/protobuf/timestamp.proto";

// 订单方向
enum Side {
  SIDE_UNSPECIFIED = 0;
  SIDE_BUY = 1;
  SIDE_SELL = 2;
}

// 订单类型
enum OrderType {
  ORDER_TYPE_UNSPECIFIED = 0;
  ORDER_TYPE_LIMIT = 1;
  ORDER_TYPE_MARKET = 2;
  ORDER_TYPE_STOP_LIMIT = 3;      // V1
  ORDER_TYPE_STOP_MARKET = 4;     // V1
  ORDER_TYPE_TAKE_PROFIT_LIMIT = 5;
  ORDER_TYPE_TAKE_PROFIT_MARKET = 6;
}

// 有效期类型
enum TimeInForce {
  TIME_IN_FORCE_UNSPECIFIED = 0;
  TIME_IN_FORCE_GTC = 1;          // Good Till Cancel
  TIME_IN_FORCE_IOC = 2;          // Immediate Or Cancel
  TIME_IN_FORCE_FOK = 3;          // Fill Or Kill
  TIME_IN_FORCE_POST_ONLY = 4;    // Maker Only
}

// 订单状态
enum OrderStatus {
  ORDER_STATUS_UNSPECIFIED = 0;
  ORDER_STATUS_NEW = 1;
  ORDER_STATUS_PARTIALLY_FILLED = 2;
  ORDER_STATUS_FILLED = 3;
  ORDER_STATUS_CANCELED = 4;
  ORDER_STATUS_REJECTED = 5;
  ORDER_STATUS_EXPIRED = 6;
  ORDER_STATUS_PENDING_CANCEL = 7;
}

// 自成交保护模式
enum SelfTradePreventionMode {
  STP_UNSPECIFIED = 0;
  STP_NONE = 1;           // 不启用
  STP_CANCEL_TAKER = 2;   // 取消 taker
  STP_CANCEL_MAKER = 3;   // 取消 maker
  STP_CANCEL_BOTH = 4;    // 取消双方
}

// 订单
message Order {
  string order_id = 1;
  string client_order_id = 2;
  string user_id = 3;
  string symbol = 4;
  Side side = 5;
  OrderType type = 6;
  TimeInForce time_in_force = 7;

  // 价格与数量（使用字符串避免精度问题）
  string price = 8;           // 限价单价格
  string stop_price = 9;      // 止损/止盈触发价
  string orig_qty = 10;       // 原始数量
  string executed_qty = 11;   // 已成交数量
  string cumulative_quote_qty = 12; // 累计成交额

  OrderStatus status = 13;
  string reject_reason = 14;
  string cancel_reason = 15;

  SelfTradePreventionMode stp_mode = 16;

  int64 create_time_ms = 17;
  int64 update_time_ms = 18;
  int64 transact_time_ms = 19;  // 最后成交时间
}

// 下单请求
message CreateOrderRequest {
  string symbol = 1;
  Side side = 2;
  OrderType type = 3;
  TimeInForce time_in_force = 4;
  string price = 5;
  string quantity = 6;
  string quote_order_qty = 7;   // 市价买单：花多少钱
  string client_order_id = 8;
  SelfTradePreventionMode stp_mode = 9;
}

// 下单响应
message CreateOrderResponse {
  Order order = 1;
}

// 撤单请求
message CancelOrderRequest {
  string symbol = 1;
  string order_id = 2;
  string client_order_id = 3;  // order_id 和 client_order_id 二选一
}

// 撤单响应
message CancelOrderResponse {
  Order order = 1;
}

// 查询订单请求
message GetOrderRequest {
  string symbol = 1;
  string order_id = 2;
  string client_order_id = 3;
}

// 查询当前委托请求
message ListOpenOrdersRequest {
  string symbol = 1;  // 可选，不传则查所有
  int32 limit = 2;
}

// 查询历史订单请求
message ListOrdersRequest {
  string symbol = 1;
  int64 start_time_ms = 2;
  int64 end_time_ms = 3;
  string from_order_id = 4;  // 分页游标
  int32 limit = 5;
}

// 订单列表响应
message ListOrdersResponse {
  repeated Order orders = 1;
}
