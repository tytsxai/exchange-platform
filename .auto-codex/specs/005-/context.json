{
  "task_description": "Implement end-to-end wallet deposit/withdraw flow with hot wallet address management, approval-gated withdrawals, multi-confirmation crediting, and on-chain reconciliation.",
  "scoped_services": [
    "exchange-wallet",
    "exchange-clearing"
  ],
  "files_to_modify": {
    "exchange-wallet": [
      "exchange-wallet/cmd/wallet/main.go",
      "exchange-wallet/internal/service/wallet.go",
      "exchange-wallet/internal/service/deposit_scanner.go",
      "exchange-wallet/internal/service/repository.go",
      "exchange-wallet/internal/repository/wallet.go",
      "exchange-wallet/internal/client/clearing.go",
      "exchange-wallet/api/openapi.yaml"
    ],
    "exchange-clearing": [
      "exchange-clearing/cmd/reconciliation/main.go"
    ],
    "exchange-common": [
      "exchange-common/scripts/init-db.sql"
    ]
  },
  "files_to_reference": [
    "exchange-wallet/internal/service/wallet.go",
    "exchange-wallet/internal/service/deposit_scanner.go",
    "exchange-wallet/internal/repository/wallet.go",
    "exchange-wallet/internal/service/mock_test.go",
    "exchange-wallet/internal/service/wallet_service_test.go",
    "exchange-clearing/cmd/reconciliation/main.go",
    "exchange-common/scripts/init-db.sql"
  ],
  "patterns": {
    "service_pattern": "Service layer orchestrates business logic and calls repository interfaces; external calls go through internal/client adapters.",
    "repository_pattern": "Repositories use sql.DB with typed structs, status constants, and explicit SQL for CRUD.",
    "handler_pattern": "HTTP handlers in cmd/*/main.go use net/http mux with JSON encode/decode and header-based context (user/approver)."
  },
  "existing_implementations": {
    "deposit_flow": "WalletService.ProcessDeposit upserts deposits, checks confirmations, and credits via ClearingClient before updating status.",
    "withdrawal_flow": "WalletService.RequestWithdraw creates withdrawal and freezes funds; approve/reject/complete update status and ledger.",
    "reconciliation_reporting": "exchange-clearing/cmd/reconciliation/main.go compares ledger entries to balances with SQL queries and can write a JSON report."
  },
  "created_at": "2025-12-24T05:10:00Z"
}
