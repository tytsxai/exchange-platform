---
title: 交易所项目-落地文档
topic: 项目文档/交易所
tags:
  - 交易所
  - 项目文档
  - PRD
  - 架构
summary: >
  本交易所项目的统一落地文档：范围与非目标、业务规则、需求拆解、非功能指标、里程碑、风险与待确认问题；与通用总纲配套使用。
created: 2025-12-21
updated: 2025-12-22
stage: draft
visibility: internal
owner: me
ai_include: true
source: ""
---

# 交易所项目-落地文档

> 本文档回答“我们要做什么、做到什么程度、什么时候做完、关键选择是什么”。实现细节与通用模块设计见：[交易所开发-通用总纲.md](交易所开发-通用总纲.md)，关键选择落到 ADR：[`ADR/ADR-000-索引.md`](ADR/ADR-000-索引.md)。

## 快速入口（先写这些）
- 术语表：[交易所项目-术语表.md](交易所项目-术语表.md)
- 架构总览：[交易所项目-架构总览.md](交易所项目-架构总览.md)
- 接口契约：[交易所项目-接口契约.md](交易所项目-接口契约.md)
- 数据模型：[交易所项目-数据模型.md](交易所项目-数据模型.md)
- 事件模型：[交易所项目-事件模型与消息规范.md](交易所项目-事件模型与消息规范.md)
- 测试与验收：[交易所项目-测试与验收.md](交易所项目-测试与验收.md)
- 运维 Runbook：[交易所项目-运维Runbook.md](交易所项目-运维Runbook.md)
- ADR 索引：[ADR/ADR-000-索引.md](ADR/ADR-000-索引.md)
- 核心功能矩阵：[交易所项目-核心功能矩阵.md](交易所项目-核心功能矩阵.md)
- 路线图：[交易所项目-任务拆解与路线图.md](交易所项目-任务拆解与路线图.md)

## 项目快照
> 先把这一节填完整，就能开工；其余章节逐步细化即可。

### 当前范围（建议默认）
- 核心目标：核心功能“都实现”，是否开放由开关决定（见 [交易所项目-核心功能矩阵.md](交易所项目-核心功能矩阵.md)）
- 市场：现货优先；合约/杠杆能力在架构与文档中预留
- 出入金：先实现“能力与流程”（含风控/审计），是否对外开放按合规与资源决定
- 订单类型：`LIMIT`、`MARKET` 优先；高级订单先实现再灰度启用
- 一致性优先级：资金一致性 > 订单一致性 > 行情一致性（不变）

### 项目决策快照（建议先拍板）
| 项目项 | 建议默认 | 当前选择 | 备注 |
|---|---:|---:|---|
| 市场形态 | 现货 | 现货 | 合约/杠杆先预留（见 [ADR/ADR-004-合约价格体系（指数-标记价）.md](ADR/ADR-004-合约价格体系（指数-标记价）.md)） |
| 对外接入 | REST + WS | REST + WS | 私有回报走 WS（最终一致） |
| 资金 truth | 账本（Ledger） | 账本（Ledger） | 见 [ADR/ADR-002-资金账本与一致性模式.md](ADR/ADR-002-资金账本与一致性模式.md) |
| 撮合保序 | 按 `symbol` 分片串行 | 按 `symbol` 分片串行 | 见 [ADR/ADR-001-撮合分片与保序策略.md](ADR/ADR-001-撮合分片与保序策略.md) |
| 行情模型 | 快照 + 增量 + seq | 快照 + 增量 + seq | 见 [ADR/ADR-003-行情链路与回补策略.md](ADR/ADR-003-行情链路与回补策略.md) |
| 事件一致性 | Outbox | Outbox | 见 [ADR/ADR-007-事件总线与Outbox一致性.md](ADR/ADR-007-事件总线与Outbox一致性.md) |

### 关键产出物（M0 必须有）
- 范围冻结：第 2 章（支持/不支持）填完
- ADR：至少拍板 `ADR-001/002/003`（撮合/资金/行情）
- 接口契约 + 数据模型：能支持开发联调与验收用例编写

### 待确认（不确认就不要进入开发）
- 市场：只做现货还是现货 + 合约？→ **现货优先，合约能力预留**
- 是否包含出入金？（链上/法币/都不做）→ **仅链上出入金**
- 费率与手续费扣费资产（默认扣 quote 还是支持多资产/平台币抵扣）？→ **默认扣 quote，固定费率（MVP）**
- 支持哪些订单类型与 TIF？是否启用自成交保护？→ **LIMIT/MARKET + GTC（MVP），STP 可选启用**
- 目标容量：单 `symbol` TPS、撮合 p99、WS 推送延迟目标
  - 订单峰值（ops）：1000 ops/symbol（MVP）
  - 撮合 p99（ms）：< 10ms
  - WS 推送 p99（ms）：< 50ms

## 0 目录
- [[#快速入口（先写这些）]]
- [[#项目快照]]
- [[#1 背景与目标]]
- [[#2 范围与非目标]]
- [[#3 产品形态与业务规则]]
- [[#4 角色与权限]]
- [[#5 需求拆解（MVP-V1）]]
- [[#6 非功能需求（SLO）]]
- [[#7 关键决策（ADR）清单]]
- [[#8 里程碑与交付物]]
- [[#9 风险、假设与待确认问题]]
- [[#10 依赖、资源与成本]]
- [[#11 版本记录]]

---

## 1 背景与目标
### 1.1 背景
- 一句话定位：通用交易引擎，支持多种资产类型的现货撮合与清算
- 用户与场景：C端散户，Web/App 交易
- 当前痛点（为什么要做）：需要一套可复用的交易核心，支持快速接入不同资产类型
- 现在的时机（为什么是现在）：业务扩展需要标准化交易能力

### 1.2 项目目标（可量化）
- 业务目标：支撑日活交易用户（TBD）、日成交额（TBD）
- 技术目标：撮合 p99 < 10ms，可用性 99.9%，资金一致性 100%

### 1.3 成功标准（验收口径）
- 上线验收（必须可测试）：
  - 资金一致性：对账异常为 0（见 [交易所项目-测试与验收.md](交易所项目-测试与验收.md)）
  - 撮合正确性：价格优先/时间优先用例全部通过
  - 可用性：核心交易链路达到目标 SLO
- 运营验收（可选）：
  - 费率/交易对/风控规则可配置且可审计
- 风险验收（资金/安全）：
  - 幂等与防重放生效（接口签名 + 去重）
  - 关键操作留痕（资金/风控/配置变更）

---

## 2 范围与非目标
### 2.1 本期范围（明确到“支持/不支持”）
- 市场：
  - [x] 现货（MVP）
  - [ ] 永续合约
  - [ ] 交割合约
  - [ ] 杠杆
- 订单类型：
  - [x] `LIMIT`
  - [x] `MARKET`
  - [ ] `STOP` / `TAKE_PROFIT`（后续）
  - [ ] `POST_ONLY`（可选）
- TIF：
  - [x] `GTC`
  - [ ] `IOC`（可选）
  - [ ] `FOK`（可选）
- 接入：
  - [x] REST
  - [x] WebSocket
  - [ ] 机构回调（可选）
- 资产与精度：
  - 交易对清单（MVP 示例）：

| symbol | baseAsset | quoteAsset | priceTick | qtyStep | minQty | minNotional |
|--------|-----------|------------|-----------|---------|--------|-------------|
| BTCUSDT | BTC | USDT | 0.01 | 0.0001 | 0.0001 | 10 |
| ETHUSDT | ETH | USDT | 0.01 | 0.001 | 0.001 | 10 |
| SOLUSDT | SOL | USDT | 0.001 | 0.01 | 0.01 | 5 |

  - 说明：`priceTick` 最小价格变动，`qtyStep` 最小数量步长，`minNotional` 最小成交额（USDT）

### 2.2 非目标（本期明确不做）
- 不做：法币出入金、合约交易、杠杆借贷、高级订单（冰山/TWAP）、做市专属通道

### 2.3 约束条件
- 合规/地区：基础合规（需要 KYC，无严格监管要求）
- 交付期限：TBD
- 团队与技术栈：TBD

---

## 3 产品形态与业务规则
### 3.1 交易（现货）
- 费用：
  - maker/taker（是否分层）：**否，MVP 统一费率 0.1%**
  - 手续费扣费资产：**默认扣 quote（USDT）**
  - 返佣：**MVP 不做，V1 再加**
- 精度与下单约束：
  - 最小下单量 `minQty`、最小成交额 `minNotional`：见 2.1 交易对清单
  - 价格精度 `priceTick`、数量精度 `qtyStep`：见 2.1 交易对清单
- 价格保护（建议必须有）：
  - 限价单：价格偏离参考价 ±5%（可配置）
  - 市价单：最大成交额 100,000 USDT（可配置）
- 自成交保护：
  - 是否启用：**MVP 关闭，V1 可选启用**
  - 命中策略：拒绝 taker 订单（如启用）

### 3.2 合约（如做）
- 价格体系：指数/标记/最新（采用方案）
- 保证金：全仓/逐仓（采用方案）
- 强平策略：触发条件与执行路径
- 资金费率：周期与结算链路

### 3.3 风控与开关
- 下单限流：按用户/IP/API Key
- 熔断：只允许撤单/暂停交易/按 `symbol` 暂停

---

## 4 角色与权限
- 普通用户：下单/撤单/查询/资金
- 机构/做市：更高限频、专属回报（如有）
- 运营：配置交易对、费率、风控规则、公告
- 风控：黑白名单、阈值、审计查看
- 财务：对账、报表、出入金审核（如有）
- 管理员：权限与密钥管理、紧急开关

---

## 5 需求拆解（MVP-V1）
### 5.1 MVP（必须闭环）
- 账户与资产：余额、冻结、流水（账本）
- 交易：下单/撤单/撮合/成交回报
- 清算：成交影响落账（资金不丢、不重记）
- 行情：盘口/逐笔/WebSocket 推送
- 查询：订单、成交、资产历史
- 运维最小集：监控、告警、日志追踪、开关

### 5.2 V1（增强）
- 风控规则平台（可配置、可审计）
- 手续费阶梯与返佣（如需要）
- K 线与报表体系
- 灾备/恢复能力强化

### 5.3 明确“暂不做”的增强项
- 高级订单（冰山、TWAP 等）：
- 做市与撮合特殊规则：

---

## 6 非功能需求（SLO）
- 可用性：`99.9%`（目标/范围）
- 延迟：撮合 p99（目标）、API p99（目标）
- 吞吐：订单/秒、推送消息/秒
- 一致性：账本/账户一致性校验频率与容忍度（应为 0）
- 安全：密钥轮换周期、审计留存周期

---

## 7 关键决策（ADR）清单
> 只列“必须拍板”的问题；拍板后写入 ADR。

- [ADR-001-撮合分片与保序策略.md](ADR/ADR-001-撮合分片与保序策略.md)：撮合分片键、保序与热点治理
- [ADR-002-资金账本与一致性模式.md](ADR/ADR-002-资金账本与一致性模式.md)：source of truth、清算写路径与幂等去重
- [ADR-003-行情链路与回补策略.md](ADR/ADR-003-行情链路与回补策略.md)：行情生成、推送与回补
- [ADR-004-合约价格体系（指数-标记价）.md](ADR/ADR-004-合约价格体系（指数-标记价）.md)：合约价格体系（如做合约）

---

## 8 里程碑与交付物
- M0 对齐：范围冻结、接口草案、验收标准（TBD）
- M1 MVP：现货闭环（TBD）
- M2 稳定性：压测、故障演练、风控与开关（TBD）
- M3 上线：灰度、监控面板、应急预案（TBD）

---

## 9 风险、假设与待确认问题
### 9.1 风险清单
- 资金一致性：清算/账本写入并发竞态、幂等失效导致重复记账
- 行情延迟与断流：撮合事件积压、WS 推送瓶颈、回补策略不完善
- 合约强平与穿仓（如做）：标记价异常、强平引擎延迟、保险基金不足
- 合规与地区限制：KYC 流程不完善、数据留存不满足要求

### 9.2 待确认问题（必须给出答案）
- 本期是否包含出入金？→ **是，仅链上出入金**
- 支持哪些订单类型与 TIF？→ **LIMIT/MARKET + GTC（MVP）**
- 是否需要做市/机构专属回报？→ **本期不做**
- 费率与返佣规则是否已确定？→ **固定费率（MVP），返佣后续迭代**

---

## 10 依赖、资源与成本
- 外部依赖：KYC/AML 服务（第三方）、链上节点/托管服务、行情指数（如有）
- 人力：后端/前端/测试/运维/安全（TBD）
- 成本：服务器、带宽、第三方服务（TBD）

---

## 11 版本记录
- 2025-12-21：创建初版（范围/需求骨架）。
- 2025-12-22：补充项目定位（通用交易引擎）、目标、范围勾选、待确认问题答案、风险清单。
