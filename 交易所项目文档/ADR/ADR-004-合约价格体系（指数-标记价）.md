---
title: ADR-004-合约价格体系（指数-标记价）
topic: 项目文档/ADR
tags:
  - 交易所
  - 合约
  - 标记价
  - 指数
  - ADR
summary: >
  如做合约：记录指数来源、标记价计算方式、异常剔除、断流容灾与对强平/风控的影响。
created: 2025-12-21
updated: 2025-12-21
stage: draft
visibility: internal
owner: me
ai_include: true
source: ""
---

# ADR-004-合约价格体系（指数-标记价）

## 背景（如做合约）
- 合约的强平、风控与资金安全依赖“标记价（Mark Price）”，不能直接使用最新成交价（易被操纵/插针）。
- 需要一个可解释、可容灾的“指数价（Index Price）”与“标记价”体系，并明确断流/异常时的降级策略。

## 决策（建议默认）
### 1) 指数来源
- 选择 N 个主流交易所现货价格作为指数来源（至少 3 家），并配置权重（成交量/流动性）。
- 对每个来源做健康检查：延迟、断流、价格偏离（超过阈值直接剔除）。

### 2) 标记价计算（写清口径即可，公式可后补）
- 基础：`IndexPrice` 作为锚
- `MarkPrice` 用于：
  - 未实现盈亏（UPnL）
  - 强平触发判断
  - 风险率/保证金率计算
- 推荐：`MarkPrice = IndexPrice + clamp(PremiumIndex, [-cap, +cap]) * IndexPrice`（premium 的定义与计算窗口待补）

### 3) 异常剔除与断流
- 单来源异常：剔除
- 多来源异常：进入“保护模式”
  - 冻结开仓（仅允许平仓/减仓）
  - 提高保证金要求（可选）
  - 标记价采用“最后可信指数价”并限制变化率（rate limit）

### 4) 与强平/风控关系
- 强平判断基于 `MarkPrice`，而不是最新价
- 风控规则（如价格保护）应使用 `Index/Mark` 作为参考价

## 备选方案
- 只用单一来源：实现简单但容灾差（不推荐）
- 只用最新价：易被操纵（不推荐）
- 多源指数 + 标记价（本 ADR 默认）

## 影响
- 正向：降低插针/操纵风险；强平口径更稳定；可解释性更强。
- 代价：需要维护外部行情源与容灾；需要做监控与质量评估。

## 验证与回滚
- 验证：构造单源断流/异常偏离/全网波动，标记价仍连续且可解释；保护模式能正确触发。
- 回滚：若指数系统不可用，立即降级为“仅允许平仓/撤单”，暂停开仓并公告（安全优先）。
