---
title: 交易所项目-商业交易所落地路线图
topic: 项目文档/交易所
tags:
  - 交易所
  - 路线图
  - 任务清单
  - MVP
summary: >
  以 4-6 周 MVP 为目标，补齐后端引擎到“可运营、可上线灰度”的交易所缺口，覆盖钱包/清算/撮合/做市/后台/前端/运维与验收的可执行任务清单（默认决策已给出）。
created: 2025-12-22
updated: 2025-12-22
stage: draft
visibility: internal
owner: me
ai_include: true
source: ""
---

# 交易所项目-商业交易所落地路线图

> 目标：填补“后端引擎”与可运营、可产生收入的交易所之间的缺口。MVP 预计 4-6 周完成（封闭内测 -> 白名单 -> 小流量开放）。

**复查结论（已在正文落地）**
- 以仓库现状为准：当前钱包侧仅实现 `TRON` 客户端，MVP 链路按“TRON 单链”落地；EVM 多链作为 Phase 2。
- 鉴权口径需要统一：Web 端使用会话/JWT；开放 API 使用 API Key + HMAC；管理员使用独立 RBAC + 2FA。
- “可选/占位”项一律给默认：若要“可直接上线生产”，必须写清默认开关与灰度顺序。

## 0 目录
- [[#1 目标与范围]]
- [[#2 关键决策点（已按推荐默认，可调整）]]
- [[#3 里程碑与时间线（4-6 周）]]
- [[#4 任务清单（按模块/工作流）]]
- [[#5 依赖与交付物]]
- [[#6 验证与验收（MVP 口径）]]
- [[#7 风险与待确认]]
- [[#8 上线与灰度策略]]
- [[#9 Go/No-Go 清单]]
- [[#10 角色与责任]]
- [[#11 附录（冻结口径）]]

---

## 1 目标与范围
### 1.1 MVP 目标
- 资金闭环：充值可入账、提现可出款、账本一致。
- 交易闭环：订单簿持续有流动性、撮合可用、行情可订阅。
- 运营闭环：后台可管用户/资产/交易对/提现审核。
- 体验闭环：Web 端可完成钱包连接登录、交易、充值、提现。

### 1.2 MVP 范围
- 资产（按“可上线灰度”定义）：**MVP 首发 TRON 单链**（TRX + USDT(TRC20)）；Phase 2 扩展 EVM 链（Ethereum/BSC）与更多资产。
- 市场：现货交易（**1 个交易对：TRX/USDT**），做市维持深度；Phase 2 再增第二个交易对。
- 前端：Web MVP（Next.js），响应式/PWA，移动端友好。
- 登录：钱包连接为主（WalletConnect/签名登录），不托管用户钱包私钥（但交易所托管用户充值到平台的资产）。
- 后台：Admin Dashboard（用户/财务/市场配置/风控）。
- 合规：基础风控与审计；对外开放前必须具备 KYC/黑名单策略（MVP 可先封闭内测/白名单）。

### 1.3 非目标（MVP 不做）
- 法币出入金、合约/杠杆、复杂订单类型（冰山/TWAP）。
- 高级用户画像与增长体系。

### 1.4 落地边界（MVP 默认冻结）
- **链路冻结**：TRON（主网）+ USDT(TRC20) + TRX（Gas 与充值/提现）。
- **交易冻结**：仅 `TRXUSDT`；订单类型仅限价/市价；TIF 默认 GTC。
- **资金口径冻结**：`exchange_clearing.ledger_entries` 为资金真相（幂等）；链上仅作为出入金外部事实来源。
- **存取款冻结**：充值入账需确认数达标；提现必须走审核（默认人工复核 + 2FA）。

---

## 2 关键决策点（已按推荐默认，可调整）
| 决策点 | 选项 | 推荐 | 当前选择 | 备注 |
|---|---|---|---|---|
| 前端策略 | Web MVP / 白标移动端 | Web MVP | Web MVP + 响应式/PWA | 覆盖桌面与移动端 |
| 登录方式 | 钱包连接 / 账号体系 | 钱包连接为主 | WalletConnect + 签名登录 | 不托管钱包私钥（资产为托管） |
| 钱包架构 | 热钱包 + 冷存储 / MPC | 热 + 冷 | 热 + 冷 | MVP 不做 MPC |
| 链与资产 | 单链 / 多链多资产 | 分阶段 | **MVP：TRON(TRC20)**；Phase 2：EVM | 与当前代码现状对齐 |
| 节点接入 | 公共 RPC / 自建节点 | 公共 RPC | TRONGrid/公共节点 + 备用节点 | 生产可切换付费/自建 |
| 充值确认数 | 配置化 | 中等 | TRON 12 | Phase 2 再补 EVM |
| 提现风控阈值 | 10k/20k/50k USDT | 20k | 20,000 USDT 二次复核 | 可调 |
| 交易对 | 1-2 对 / 多对 | 1-2 对 | **MVP：TRX/USDT** | Phase 2 再加第二对 |
| 交易费率 | 0.1%/0.1% 等 | 0.1%/0.1% | maker 0.1% / taker 0.1% | MVP 统一 |
| 提现手续费 | 固定 / 动态 gas | 固定 + gas | 按链固定 + 动态 gas | 透明可调 |
| 做市策略 | 自研 / 开源 / 采购 | 开源+自研 | Hummingbot + 镜像策略 | 价格源 Binance 主、Huobi 备 |
| 合规策略 | KYC 强制 / 预留 | 分阶段 | MVP 内测/白名单不强制；对外开放前强制 | 基础风控 |
| 管理员权限 | 单管理员 / RBAC | RBAC | RBAC + 超级管理员 | 大额提现二次复核 |
| 发布环境 | Dev+Prod / Dev+Stage+Prod | Dev+Stage+Prod | Dev+Stage+Prod | 白名单灰度 |
| 监控告警 | 邮件/Telegram/Slack | 邮件+Telegram | 邮件 + Telegram | MVP 足够 |
| 容量目标 | 轻量 / 中等 | 中等 | 并发 500，单对 200-500 orders/s | 可扩展 |
| 私钥管理 | env / KMS | KMS | **热钱包密钥：KMS/加密文件（二选一）**；冷钱包离线 | 直接生产不建议纯 env 明文 |
| 2FA/白名单 | 可选 / 强制 | 可选 | 大额提现强制 2FA + 白名单 | 低门槛 |
| 鉴权策略 | JWT / API Key-HMAC | 双轨 | **Web：JWT；API：HMAC；Admin：RBAC+2FA** | 降低前端复杂度 |

---

## 3 里程碑与时间线（4-6 周）
| 周期 | 目标 | 关键输出 |
|---|---|---|
| 第 0 周 | 决策冻结 | 前端策略/钱包架构/链与交易对拍板 |
| 第 1-2 周 | 资金闭环 | 钱包服务、充值入账、提现出款、对账 |
| 第 2-3 周 | 交易闭环 | 做市机器人、行情订阅、撮合稳定 |
| 第 3-4 周 | 运营闭环 | 管理后台功能可用、风控开关 |
| 第 4-5 周 | 用户体验闭环 | Web MVP 核心页面与交易流程 |
| 第 5-6 周 | 上线准备 | 监控告警、灰度策略、验收测试 |

---

## 4 任务清单（按模块/工作流）

### 4.0 本周启动清单（建议立即执行）
- [ ] INIT-01 确认前端策略（Web MVP 或白标移动端）
- [ ] INIT-02 确认钱包架构（热 + 冷）
- [ ] INIT-03 冻结接口契约最小集（以 `exchange-*/api/openapi.yaml` 为准）
- [ ] INIT-04 冻结数据模型最小集（以 `exchange-common/scripts/init-db.sql` 为准）
- [ ] INIT-05 `exchange-wallet` 连接 TRON RPC（含备用节点与健康检查）
- [ ] INIT-06 初始化 DB（确认 `deposits` / `withdrawals` / `ledger_entries` 等表已就绪）
- [ ] INIT-07 新建 `exchange-admin-frontend` 项目（React Admin/Refine）
- [ ] INIT-08 新建 `exchange-web` 项目（Next.js 14）
- [ ] INIT-09 `exchange-web` 优先接入行情 WebSocket
- [ ] INIT-10 冻结首批链/资产/交易对/费率清单
- [ ] INIT-11 确认钱包连接登录流程（WalletConnect/签名）
- [ ] INIT-12 初始化配置：`TRON` 网络 + `TRX/USDT(TRC20)` + `TRXUSDT`（通过 DB 初始化或 Admin API）

### 4.1 钱包与出入金（exchange-wallet / exchange-clearing）
- [ ] WAL-01 TRON RPC 连接与健康检查（公共节点 + 备用节点）
- [ ] WAL-02 资产/网络配置中心（链、确认数、手续费、精度、开关）
- [ ] WAL-03 BIP44 地址生成与用户地址分配（按链记录派生路径）
- [ ] WAL-04 充值监听：TRON 扫描与去重（txid + index）
- [ ] WAL-05 确认数达标后入账（按链配置，写账本）
- [ ] WAL-06 自动归集（Sweeper）按链执行（阈值/手续费可配置）
- [ ] WAL-07 Gas 管理：热钱包补充 TRX
- [ ] WAL-08 提现申请状态机（含 network/asset 选择）
- [ ] WAL-09 提现签名与广播（TRON 适配器；预留多链接口）
- [ ] WAL-10 冷钱包操作流程与白名单（人工步骤清单）
- [ ] WAL-11 对账作业（链上余额 vs 账本余额）
- [ ] WAL-12 钱包事件审计日志（谁操作、何时、结果）
- [ ] WAL-13 钱包关键告警（监听延迟、归集失败、提现失败）
- [ ] WAL-14 Phase 2：EVM 客户端与扫描器（ERC20/BEP20）

### 4.2 账本与清算（exchange-clearing）
- [ ] CLR-01 充值入账写 `ledger_entries` 并更新余额快照
- [ ] CLR-02 提现冻结/扣减与解冻的账本口径
- [ ] CLR-03 充值/提现幂等键设计与校验
- [ ] CLR-04 对账报表输出（按资产/用户/时间）

### 4.3 流动性注入（Market Maker）
- [ ] LIQ-01 价格源选择（Binance/Huobi）与容灾策略
- [ ] LIQ-02 做市机器人：镜像挂单与价差控制
- [ ] LIQ-03 风险控制：最大仓位、最大滑点、单日亏损阈值
- [ ] LIQ-04 停止条件与一键撤单（紧急降级）
- [ ] LIQ-05 做市账户资金划拨与报表

### 4.4 管理后台服务（exchange-admin）
- [ ] ADM-01 Admin 账号体系与 RBAC
- [ ] ADM-02 用户管理：冻结/解冻、重置 2FA
- [ ] ADM-03 财务：充值/提现列表与审核流
- [ ] ADM-04 市场配置：交易对、精度、费率、限额
- [ ] ADM-05 风控开关：Kill Switch、只撤单、暂停交易
- [ ] ADM-06 大额提现二次审批与阈值配置
- [ ] ADM-07 审计日志：配置变更与高风险操作记录
- [ ] ADM-08 资产/链配置：确认数、手续费、开关

### 4.5 管理后台前端（exchange-admin-frontend）
- [ ] AFE-01 React Admin/Refine 初始化与登录页
- [ ] AFE-02 用户管理页（搜索、状态、冻结）
- [ ] AFE-03 提现审核页（审核/拒绝/备注）
- [ ] AFE-04 资产总览页（资产分布、待处理提现）
- [ ] AFE-05 交易对与费率配置页
- [ ] AFE-06 风控开关与审计日志页
- [ ] AFE-07 资产/网络配置页

### 4.6 Web 前端（exchange-web）
- [ ] WEB-01 Next.js 14 + Tailwind + 状态管理初始化
- [ ] WEB-02 钱包连接登录（WalletConnect）+ 签名验证
- [ ] WEB-03 登录/注册/忘记密码流程（可选）
- [ ] WEB-04 行情 WebSocket 订阅（depth/trades/ticker）
- [ ] WEB-05 交易终端：订单簿、K 线（TradingView）、成交记录
- [ ] WEB-06 下单/撤单与订单历史
- [ ] WEB-07 资产页：充值二维码（含网络选择）与提现表单
- [ ] WEB-08 设置：API Key、密码、KYC 占位
- [ ] WEB-09 异常态与安全提示（余额不足/风控拒单）

### 4.7 API 与网关联调（exchange-gateway / exchange-marketdata）
- [ ] API-01 私有 API 鉴权与签名规则落地
- [ ] API-02 私有 WS 回报通道联调（订单/余额变更）
- [ ] API-03 行情 WS 订阅与断线重连策略
- [ ] API-04 限流与黑白名单策略（用户/IP/API Key）
- [ ] API-05 钱包连接登录签名验证与会话管理

### 4.8 运维与安全
- [ ] OPS-01 Secrets 管理与权限隔离（热钱包密钥/KMS、管理后台密钥）
- [ ] OPS-02 监控指标（钱包延迟、撮合延迟、WS 推送延迟）
- [ ] OPS-03 关键告警与通知通道（短信/邮件/机器人）
- [ ] OPS-04 数据备份与灾备策略
- [ ] OPS-05 运行手册与应急预案更新（见 Runbook）

### 4.9 环境与发布
- [ ] REL-01 Dev/Stage/Prod 环境划分与配置隔离
- [ ] REL-02 域名、HTTPS 证书与安全头配置
- [ ] REL-03 发布流程与回滚方案（灰度/蓝绿）
- [ ] REL-04 CI/CD 基础流水线（构建/部署/回滚）

### 4.10 风控与合规（MVP 最小集）
- [ ] RSK-01 提现安全：2FA（大额强制）+ 地址白名单（默认关闭，白名单灰度开）
- [ ] RSK-02 大额提现阈值与人工复核流程（默认开启）
- [ ] RSK-03 下单风控：价格保护、限频、黑白名单
- [ ] RSK-04 合规占位：KYC 状态字段与接口预留（对外开放前接入）

### 4.11 测试与验收
- [ ] QA-01 钱包 TRON 充值/提现全链路验证（Phase 2 再补 EVM）
- [ ] QA-02 撮合正确性用例（价格优先/时间优先）
- [ ] QA-03 断线重连与行情回补验证
- [ ] QA-04 对账与幂等校验（重复事件不重复记账）
- [ ] QA-05 关键路径压测（撮合/行情/清算）

### 4.12 运营与客服
- [ ] BIZ-01 工单/客服入口（最小流程：问题分类、工单号、处理状态）
- [ ] BIZ-02 公告与系统状态页（上线/维护窗口）
- [ ] BIZ-03 费用与活动配置入口（若需要）

### 4.13 用户与认证（exchange-user）
- [ ] USR-01 钱包签名登录与地址绑定
- [ ] USR-02 可选邮箱/手机号绑定与通知
- [ ] USR-03 2FA（TOTP）启用与提现强制规则
- [ ] USR-04 API Key 生成/权限/白名单
- [ ] USR-05 登录风控（IP/设备指纹/异常告警）

---

## 5 依赖与交付物
### 5.1 关键依赖
- TRON 公共节点/TronGrid（含 API Key）与稳定性评估（含备用节点）
- 做市价格源 API 访问与限流策略
- WalletConnect SDK 与钱包兼容性测试
- 冷钱包操作流程与签名权限划分
- 域名、HTTPS 与基础安全配置
- 链上 Gas 资产备付（TRX）

### 5.2 交付物清单
- 钱包服务：TRON 地址生成、充值监听、归集、提现签名（Phase 2 扩展多链）
- 清算与账本：充值/提现账本口径与对账报表
- 做市机器人：稳定订单簿深度与价差控制
- 管理后台：用户/财务/市场配置/风控/审计
- Web 前端：钱包连接登录、交易、资产、设置
- 运维：监控告警、Runbook、验收用例

---

## 6 验证与验收（MVP 口径）
- 钱包连接登录：签名验证通过，生成/绑定用户账户
- 充值：TRON 上 USDT/TRX 入账后，账本与余额正确更新（重复事件不重复入账）
- 提现：TRON 审批后可成功出款，状态可追踪（失败可重试/口径明确）
- 撮合：做市机器人运行后，订单簿持续有深度
- 行情：WebSocket 订阅稳定，断线可恢复
- 风控：Kill Switch 生效，操作留痕可审计

---

## 7 风险与待确认
### 7.1 风险
- 价格源不稳定导致做市失败或深度不足
- TRON 节点/TronGrid 不稳定或限流导致监听延迟
- 冷钱包操作流程不清导致提现阻塞
- 运营权限边界不清导致高风险操作失控
- Phase 2 多链（EVM）扩展复杂度拉长周期（4-6 周需严格控制 MVP 范围）
- Gas 管理不足导致提现失败或归集成本失控

### 7.2 待确认（默认值可直接执行）
- 密钥托管方案：优先云 KMS；若无云 KMS，默认“加密密钥文件 + 独立机器 + 最小权限 + 审计”。
- 对外开放口径：默认封闭内测/白名单，不做公开拉新；对外开放前必须接入 KYC/黑名单策略。
- 做市资金与止损：默认做市资金 `50,000 USDT`，单日亏损上限 `500 USDT`，触发即停市并一键撤单。
- 热钱包额度：默认热钱包资金上限 `10,000 USDT` 等值，超出自动归集至冷钱包。

---

## 8 上线与灰度策略
- MVP 建议：封闭内测 -> 白名单用户 -> 全量开放
- 功能开关：出入金与高风险功能默认关闭，灰度开启
- 链路策略：MVP 先开 TRON；Phase 2 再逐条开启 EVM
- 失败回滚：撮合/清算/行情任一异常即降级为“只撤单”
- 钱包降级：节点/API 故障时暂停入账/出款并告警

---

## 9 Go/No-Go 清单
- 资金一致性：对账异常为 0（账本余额/链上余额/热冷钱包余额三方可解释且可追溯）
- 钱包：TRON 充值/提现全链路可复现通过（Phase 2 再补 EVM）
- 登录：钱包连接签名登录可用且稳定
- 撮合：核心撮合用例通过，无资金错误
- 行情：断线重连与回补策略有效
- 风控：Kill Switch 有效且可审计
- 监控：关键指标与告警可用

---

## 10 角色与责任
- 业务负责人：目标/范围/里程碑确认与决策拍板
- 技术负责人：架构与风险控制、关键里程碑验收
- 钱包/清算负责人：出入金与账本一致性
- 运营负责人：后台流程、客服与灰度策略
- 前端负责人：Web/PWA 体验与钱包连接流程
- 风控/安全负责人：阈值配置、审计与应急策略
- 做市负责人：做市策略、成本与深度保障

---

## 11 附录（冻结口径）
### 11.1 以代码为准的“冻结来源”
- 接口契约：`exchange-gateway/api/openapi.yaml`、`exchange-wallet/api/openapi.yaml`、`exchange-admin/api/openapi.yaml`
- 数据模型：`exchange-common/scripts/init-db.sql`（PostgreSQL schema）
- 基础设施：`exchange-common/docker-compose.yml`（Postgres + Redis(Streams) + Prometheus/Grafana/Jaeger）

### 11.2 上线前硬门槛（否则不建议生产）
- **鉴权安全**：`exchange-wallet` / `exchange-admin` 的 Bearer token 需使用可验证的签名 token（已替换为 HMAC 版本化 token）。
- **密钥治理**：热钱包私钥不得以明文环境变量长期驻留（至少使用 KMS 或加密文件 + 最小权限 + 审计）。
- **灰度开关**：出金必须支持开关与多级降级（暂停提现/只撤单/暂停交易），并在后台可审计地操作。
