groups:
  - name: exchange-minimal
    rules:
      - alert: Watchdog
        expr: vector(1)
        labels:
          severity: none
        annotations:
          summary: "Watchdog"
          description: "Always firing alert to verify notification pipeline health."

      - alert: InstanceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "{{ $labels.job }} is down"

      - alert: RedisStreamPending
        expr: redis_stream_pending > 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Redis Stream pending > 0 (stream={{ $labels.stream }} group={{ $labels.group }})"

      - alert: RedisStreamDLQRate
        expr: rate(redis_stream_dlq_total[5m]) > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Messages moving to DLQ (stream={{ $labels.stream }} group={{ $labels.group }})"

      - alert: RedisStreamHandlerErrors
        expr: rate(redis_stream_handler_errors_total[5m]) > 0
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Stream handler errors detected (stream={{ $labels.stream }} group={{ $labels.group }})"

      - alert: ServiceReadyProbeFailed
        expr: probe_success{job="service-ready"} == 0
        for: 3m
        labels:
          severity: critical
        annotations:
          summary: "Service readiness probe failed (target={{ $labels.instance }})"
          description: "The /ready endpoint has been failing for more than 3 minutes."
