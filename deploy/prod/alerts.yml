groups:
  - name: exchange-minimal
    rules:
      - alert: InstanceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "{{ $labels.job }} is down"

      - alert: RedisStreamPending
        expr: redis_stream_pending > 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Redis Stream pending > 0 (stream={{ $labels.stream }} group={{ $labels.group }})"

      - alert: RedisStreamDLQRate
        expr: rate(redis_stream_dlq_total[5m]) > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Messages moving to DLQ (stream={{ $labels.stream }} group={{ $labels.group }})"

      - alert: RedisStreamHandlerErrors
        expr: rate(redis_stream_handler_errors_total[5m]) > 0
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Stream handler errors detected (stream={{ $labels.stream }} group={{ $labels.group }})"
