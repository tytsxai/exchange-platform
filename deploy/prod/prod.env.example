# Production example env.
#
# Copy to `deploy/prod/prod.env` and fill in your real values.
# Then run:
#   bash exchange-common/scripts/prod-preflight.sh
#   bash deploy/prod/deploy.sh

APP_ENV=prod

# Image tag used by docker compose (enables fast rollback by switching tag).
# Example: APP_VERSION=2025-12-24-rc1
# Production should use immutable tags; avoid `latest`.
APP_VERSION=2026-02-10-rc1
# Set to true only for emergency/manual scenarios.
ALLOW_LATEST_IMAGE_TAG=false

# Secrets (MUST NOT be placeholder values)
INTERNAL_TOKEN=
AUTH_TOKEN_SECRET=
# API Key secret encryption (>= 32 chars, used by user service)
API_KEY_SECRET_KEY=
ADMIN_TOKEN=

# Optional: lock down /metrics (Prometheus can use Authorization: Bearer <token>)
METRICS_TOKEN=

# Disable docs in prod by default
ENABLE_DOCS=false
ALLOW_DOCS_IN_NONDEV=false

# CORS: explicit allowlist (no "*")
CORS_ALLOW_ORIGINS=https://your-frontend.example.com
# Trusted proxy CIDRs for X-Forwarded-For (comma-separated).
# If your LB/proxy uses public IPs, set this to the LB CIDRs.
TRUSTED_PROXY_CIDRS=

# Managed Postgres (TLS required by code for non-dev)
DB_HOST=
DB_PORT=5432
DB_USER=
DB_PASSWORD=
DB_NAME=exchange
DB_SSL_MODE=require

# Managed Redis (auth required by code for non-dev)
REDIS_ADDR=
REDIS_PASSWORD=

# Service URLs (internal network / compose service names)
ORDER_SERVICE_URL=http://order:8081
USER_SERVICE_URL=http://user:8085
MATCHING_SERVICE_URL=http://matching:8082
CLEARING_SERVICE_URL=http://clearing:8083
CLEARING_BASE_URL=http://clearing:8083
MARKETDATA_SERVICE_URL=http://marketdata:8084

# Streams (defaults are fine, but keep explicit for clarity)
ORDER_STREAM=exchange:orders
EVENT_STREAM=exchange:events

# Consumers (unique names per replica)
MATCHING_CONSUMER_GROUP=order-updater-group
MATCHING_CONSUMER_NAME=order-updater-1
CONSUMER_GROUP=matching-group
CONSUMER_NAME=matching-1

# Matching dedupe TTL (protect against Redis stream retries)
MATCHING_ORDER_DEDUP_TTL=24h
# Matching startup recovery from DB open orders (recommended true in prod)
MATCHING_RECOVERY_ENABLED=true

# Ports (optional; defaults are fine)
# NOTE: do not set generic HTTP_PORT/WS_PORT in this multi-service env file.
# Use per-service ports instead to avoid accidental collisions.
# GATEWAY_HTTP_PORT=8080
# GATEWAY_WS_PORT=8090
# ORDER_HTTP_PORT=8081
# MATCHING_HTTP_PORT=8082
# CLEARING_HTTP_PORT=8083
# MARKETDATA_HTTP_PORT=8084
# MARKETDATA_WS_PORT=8094
# USER_HTTP_PORT=8085
# WALLET_HTTP_PORT=8086
# ADMIN_HTTP_PORT=8087

# Public marketdata WS hardening (only relevant if you expose marketdata WS to browsers)
MARKETDATA_WS_ALLOW_ORIGINS=https://your-frontend.example.com
MARKETDATA_WS_MAX_SUBSCRIPTIONS=50
